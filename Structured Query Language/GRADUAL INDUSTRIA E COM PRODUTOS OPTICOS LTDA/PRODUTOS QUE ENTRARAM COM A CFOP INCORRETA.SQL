SELECT
    PEDID.EMPCODIGO, PEDID.PEDDTEMIS, PEDID.ID_PEDIDO,
    PEDID.CLICODIGO, PEDID.TPCODIGO, PEDID.PEDORIGEM,
    PEDID.POCCODIGO, PEDID.FISCODIGO1, PEDID.PEDSITPED,

    PDPRD.PROCODIGO, PDPRD.PDPDESCRICAO, PDPRD.FISCODIGO,

    NOTAS.EMPCODIGO, NOTAS.NFCODIGO, NOTAS.NFDTEMIS,
    NOTAS.NFSIT, NOTAS.NFCHNFELETRONICA,

    NFPRO.PROCODIGO, NFPRO.NFPDESCRICAO, NFPRO.FISCODIGO,
    NFPRO.NFPQTDADE, NFPRO.NFPPCOVENDA

FROM
    PEDID
    LEFT JOIN PDNF  ON (PEDID.ID_PEDIDO = PDNF.ID_PEDIDO
                    AND PEDID.EMPCODIGO = PDNF.EMPCODIGO)
    LEFT JOIN NOTAS ON (PDNF.NFCODIGO   = NOTAS.NFCODIGO
                    AND PDNF.EMPCODIGO  = NOTAS.EMPCODIGO)

    LEFT JOIN PDPRD ON (PEDID.ID_PEDIDO = PDPRD.ID_PEDIDO
                    AND PEDID.EMPCODIGO = PDPRD.EMPCODIGO)
    LEFT JOIN NFPRO ON (NOTAS.NFCODIGO  = NFPRO.NFCODIGO
                    AND NOTAS.EMPCODIGO = NFPRO.EMPCODIGO)

        LEFT JOIN PRODU PRODU_PDPRD ON (PDPRD.PROCODIGO = PRODU_PDPRD.PROCODIGO)
        LEFT JOIN PRODU PRODU_NFPRO ON (NFPRO.PROCODIGO = PRODU_NFPRO.PROCODIGO)

WHERE
    --PEDID.PEDDTEMIS BETWEEN '01.10.2024' AND CURRENT_DATE
    PEDID.PEDDTEMIS BETWEEN @#DATE#PEDDTEMISINICIAL@ AND @#DATE#PEDDTEMISFINAL@

    AND PEDID.EMPCODIGO = 6
    AND PEDID.PEDSITPED != 'C'
    AND PEDID.PEDORIGEM = 'W'
    AND PEDID.POCCODIGO = 102

    AND (
        PDPRD.FISCODIGO IN ('5.102', '6.102')
        AND PRODU_PDPRD.PROTIPO = 'F'
    )

    AND (
            (
                NFPRO.FISCODIGO IN ('5.102', '6.102')
                AND PRODU_NFPRO.PROTIPO = 'F'
            )
        OR NFPRO.FISCODIGO IS NULL
    )

    AND (
        PDPRD.PROCODIGO = NFPRO.PROCODIGO
        OR NFPRO.PROCODIGO IS NULL
    )

ORDER BY
    PEDID.ID_PEDIDO
;
